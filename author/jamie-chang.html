<!DOCTYPE html>
<html lang="en">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>Jamie's Blog - Jamie Chang</title>
                        <link rel="stylesheet" href="../theme/css/main.css" />
                                <link href="https://blog.changs.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jamie's Blog Atom Feed" />
                        <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "0358c4be608641c1ad90cd87801da29b"}'></script><!-- End Cloudflare Web Analytics -->
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="../">Jamie's Blog</a></h1>
                        <nav><ul>
                                                <li><a href="../category/blog.html">Blog</a></li>
                        </ul></nav>
                </header><!-- /#banner -->

                <aside id="featured" class="body">
                    <article>
                        <h1 class="entry-title"><a href="../why-you-should-write-your-tools-in-python-again.html">Why you should write your tools in Python Again</a></h1>
<footer class="post-info">
        <abbr class="published" title="2025-04-08T00:00:00+01:00">
                Published: Tue 08 April 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info --><p>You're probably thinking that there are already plenty of tools written in Python.</p>
<p>But I see that most of the popular tools like <code>mypy</code> and <code>flake8</code> are built for development environments. In contrast, general purpose cli tools tend to be built in other languages, for example most of the docker/kubernetes clis are built in <code>go</code>.</p>
<p>This wasn't always the case, let's set our mind to the era of Python 2. 2.7 enjoyed an almost 10 year lifespan whilst the Python community was working on Python 3. The stability of 2.7 meant that it was easy to distribute tools as Python scripts. </p>
<p>Then Python 3 arrived with lot's of nice stuff: <code>f-strings</code>, <code>dataclasses</code>, <code>pattern-matching</code> etc.. But no more stability, a script working on 3.5 might have problems on 3.7 and so on. 3rd party dependencies adding more dimension to the problem. </p>
<p>Compiled languages like <code>go</code> and <code>rust</code> don't tend to have this problem as the binary executable is distributed, the executable no longer depends on the language itself, but on the platform it's running on. So tools must be built for every platform it's expected to run on. However in many cases this is more manageable than Python's versions and dependencies.</p>
<h2>Writing a terminal app</h2>
<p>Fast forward to the present. I've been keen on writing scripts to automate some of the more mundane tasks. I wanted to write a terminal app to display my JIRA tickets, so I don't have to deal with the clunky web UI. </p>
<p>I've' heard a lot of good things about <a href="https://github.com/Textualize/textual">textual</a>, not having the patience to learn <code>rust</code>, I gave textual a go.</p>
<p>I proudly present my little TUI (Terminal UI):</p>
<p><img alt="better-functools" src="../images/jira-list.png"></p>
<style type="text/css">
  .gist-file
  .gist-data {max-height: 500px;}
</style>

<details>

  <summary><i>Source code here</i></summary>
  <script src="https://gist.github.com/Jamie-Chang/644db95fc536506d301920f3c9f46da8.js"></script>
</details>

<p>The app itself is very simple, we're just displaying the tickets and title. Nothing fancy, speedy and to the point.</p>
<p>I won't go into too much depth on the code itself, textual worked well and was fun to use. Instead let's dive into how we distribute and run the script.</p>
<h2>So how has Python fixed its problems?</h2>
<p>In short, <a href="https://github.com/astral-sh/uv">uv</a>!</p>
<p>uv has been all the rage lately, for <a href="https://www.youtube.com/watch?v=8UuW8o4bHbw">good reasons</a>. Thanks to uv package management in Python got a lot better.</p>
<p>In my specific case I used uv for the following.</p>
<ul>
<li>manage dependencies such as Python version and packages</li>
<li>execute the script in an isolated Python environment without any hassle.</li>
</ul>
<p>Let me elaborate, at the top of my script we have:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env -S uv run --script</span>
<span class="c1"># /// script</span>
<span class="c1"># requires-python = &quot;&gt;=3.12&quot;</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     &quot;requests&quot;,</span>
<span class="c1">#     &quot;textual&quot;,</span>
<span class="c1">#     &quot;platformdirs&quot;,</span>
<span class="c1">#     &quot;tomli-w&quot;,</span>
<span class="c1">#     &quot;keyring&quot;,</span>
<span class="c1"># ]</span>
<span class="c1"># [tool.uv]</span>
<span class="c1"># exclude-newer = &quot;2025-04-09T00:00:00Z&quot;</span>
<span class="c1"># ///</span>
</code></pre></div>

<p><a href="https://peps.python.org/pep-0723/">PEP-723</a> inline metadata creates a standard to setting the metadata like dependencies at the top of the file.</p>
<p>Breaking down each line we have <code>requires-python = "&gt;=3.12"</code> for the python version and then the list of <code>dependencies</code>.</p>
<p>Finally a uv specific <a href="https://docs.astral.sh/uv/reference/settings/#exclude-newer"><code>exclude-newer</code></a> that acts as a pseudo lockfile, limiting dependencies by date instead of by version.</p>
<p>This is a whole Python project in one, and uv will happily run it with a single command:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>uv<span class="w"> </span>run<span class="w"> </span>--script<span class="w"> </span>jira-tui.py
</code></pre></div>

<p>Note the shebang <code>#!/usr/bin/env -S uv run --script</code>, a neat trick from <a href="https://akrabat.com/using-uv-as-your-shebang-line/">Rob Allen</a>. On linux the shebang line will save us from typing <code>uv run --script</code> every time.</p>
<p>Essentially uv has become the one stable runtime, as long as the user has uv scripts may be distributed easily.</p>
<h2>Python's Broad Compatibility</h2>
<p>Just distributing the script is not enough, we also need to make sure that the end user's platform can execute the script.</p>
<p>Owing to Python's popularity, most packages support all major OS's and CPU architectures out of the box.</p>
<p>In fact, it's so comfortable you hardly have to think about it:</p>
<ul>
<li>textual: the main framework was designed from the ground up to be as compatible as possible</li>
<li>keyring: used to store credentials uses different secure storage based on the OS.</li>
<li>standard lib packages like <code>pathlib</code> and <code>webbrowser</code> all work cross platform.</li>
</ul>
<p>The one time I actively considered platforms was where to store the config file, which was simply solved using the <a href="https://pypi.org/project/platformdirs/"><code>platformdirs</code></a> package.</p>
<h2>How does python compare to other languages?</h2>
<p>The <code>rust</code> and <code>go</code> tools are definitely here to stay. In fact, <code>uv</code> is almost completely written in <code>rust</code>. The main reason to use other languages are performance and concurrency. In my (biased) experience performance is not a priority for terminal applications, but your experiences may vary.</p>
<p>Python's strength lies in the fact that it's simple, easy to get started with and iterate on. This applies even more so with cli scripting, where we generally one quick changes, small feedback loop and to not think about releases. </p>
<p>The takeaway here is that whilst Python doesn't fit every use case, uv has helped it level the playing field and made scripting fun again!</p>                    </article>
                </aside><!-- /#featured -->
                    <section id="content" class="body">
                        <h1>Other articles</h1>
                        <hr />
                        <ol id="posts-list" class="hfeed">

                <li><article class="hentry">
                    <header>
                        <h1><a href="../building-a-dsl-with-python-operators.html" rel="bookmark"
                               title="Permalink to Building a DSL with Python Operators">Building a DSL with Python Operators</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-03-12T00:00:00+00:00">
                Published: Wed 12 March 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>I've been a little obsessed with operator overloading lately. First using <code>|=</code> in <a href="../sqlalchemy-footgun-discarding-the-statement.html">sqlalchemy-builder</a> and then using <code>|</code> and <code>@</code> in <a href="../better-functools-python-functional-fun.html">better-functools</a>. </p>
<p>I didn't actually know that these qualify as DSLs, specifically what's known as "internal DSLs". Funnily enough, I'm usually not a fan of DSLs. A few reasons come to mind:</p>
<ul>
<li>DSLs …</li></ul>
                        <a class="readmore" href="../building-a-dsl-with-python-operators.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../better-functools-python-functional-fun.html" rel="bookmark"
                               title="Permalink to better-functools: Python functional fun">better-functools: Python functional fun</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-03-09T00:00:00+00:00">
                Published: Sun 09 March 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>I recently put some effort into creating <a href="https://github.com/Jamie-Chang/better-functools">better-functools</a>. It's a package that adds some tooling for functional programming in Python. And allows us to write some unique looking code in a manner similar to functional languages:</p>
<p><img alt="better-functools" src="../images/better-functools.png">
<a href="https://pydantic.run/store/a075fad4d27ad9d0">Try in sandbox</a></p>
<h3>Why?</h3>
<p>At a glance this doesn't look very "Pythonic". More complex …</p>
                        <a class="readmore" href="../better-functools-python-functional-fun.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../sqlalchemy-footgun-discarding-the-statement.html" rel="bookmark"
                               title="Permalink to Sqlalchemy Footgun: Discarding the statement">Sqlalchemy Footgun: Discarding the statement</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-02-02T00:00:00+00:00">
                Published: Sun 02 February 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>This one has frustrated me for a while. </p>
<p>It starts off with a REST API route. For example in fastAPI</p>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">search_users</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">Session</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">User</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds users optionally filter by user_id&quot;&quot;&quot;</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span><span class="o">.</span><span class="n">scalars</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>

<p>Then we get asked …</p>
                        <a class="readmore" href="../sqlalchemy-footgun-discarding-the-statement.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../jamies-pattern-matching-cookbook.html" rel="bookmark"
                               title="Permalink to Jamie's Pattern Matching Cookbook">Jamie's Pattern Matching Cookbook</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-01-16T00:00:00+00:00">
                Published: Thu 16 January 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>Structural pattern matching is probably the coolest new syntax introduced to Python. Added in 3.10, it's been a few years now and more people are writing apps in 3.10<a href="https://lp.jetbrains.com/python-developers-survey-2023/#python-versions">*</a> than any other version now.</p>
<p>Though even with the wide adoption of 3.10 and more people being exposed …</p>
                        <a class="readmore" href="../jamies-pattern-matching-cookbook.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../how-good-are-sub-interpreters-in-python-now.html" rel="bookmark"
                               title="Permalink to How good are sub-interpreters in Python now?">How good are sub-interpreters in Python now?</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2025-01-03T00:00:00+00:00">
                Published: Fri 03 January 2025
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <h2>Introduction</h2>
<p>I wrote about free-threading recently in <a href="./how-free-are-threads-in-python-now.html">How free are threads in Python now?</a>. Where I found some unexpected difficulties parallelising my solution.</p>
<p>In the conclusion section I wrote:</p>
<blockquote>
<p>I'm starting to think that the approach <a href="https://peps.python.org/pep-0554/">sub-interpreters</a> is taking, with brand new concurrency primitives and shared memory data structures has …</p></blockquote>
                        <a class="readmore" href="../how-good-are-sub-interpreters-in-python-now.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../how-free-are-threads-in-python-now.html" rel="bookmark"
                               title="Permalink to How free are threads in Python now?">How free are threads in Python now?</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-12-31T00:00:00+00:00">
                Published: Tue 31 December 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>Free-threaded Python (<a href="https://peps.python.org/pep-0703/">PEP-703</a>) was released in October 2024. 
It enables true multi-threaded execution without the restriction of the <a href="https://docs.python.org/3/glossary.html#term-global-interpreter-lock">GIL</a>.</p>
<p>I previously covered this in <a href="./free-threaded-python-with-asyncio.html">Free Threaded Python With Asyncio</a>, the example used there was selected because it very clearly demonstrates the performance increase, or moreover, the threads "running free".</p>
<p>But …</p>
                        <a class="readmore" href="../how-free-are-threads-in-python-now.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../customising-pattern-matching-behaviour.html" rel="bookmark"
                               title="Permalink to Customising Pattern Matching Behaviour">Customising Pattern Matching Behaviour</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-12-09T00:00:00+00:00">
                Published: Mon 09 December 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>I've been doing <a href="https://adventofcode.com/">advent of code</a> again this year. There are two Python features I always rely on, iterators and pattern matching. Iterators allow for operations on each of its elements without allocating memory for a collection. Ever since pattern matching was introduced in Python 3.10, it's been particularly …</p>
                        <a class="readmore" href="../customising-pattern-matching-behaviour.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../python-in-python-sandboxing-llm-generated-code.html" rel="bookmark"
                               title="Permalink to Python-in-Python Sandboxing LLM Generated Code">Python-in-Python Sandboxing LLM Generated Code</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-12-02T00:00:00+00:00">
                Published: Mon 02 December 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>I've been experimenting with <a href="https://www.langchain.com/">Langchain</a> for GPT based queries. One problem we often encounter with GPT is hallucinations. This makes certain classes of problems unsuited to GPT, one example is maths and statistics. Whilst there are improvements for recent models often the maths cannot be trusted.</p>
<p>When I try to …</p>
                        <a class="readmore" href="../python-in-python-sandboxing-llm-generated-code.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>

                <li><article class="hentry">
                    <header>
                        <h1><a href="../my-sqlalchemy-cookbook.html" rel="bookmark"
                               title="Permalink to My SQLAlchemy Cookbook">My SQLAlchemy Cookbook</a></h1>
                    </header>

                    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-11-25T00:00:00+00:00">
                Published: Mon 25 November 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../author/jamie-chang.html">Jamie Chang</a>
                </address>
        <p>In <a href="../category/blog.html">Blog</a>.</p>
        
</footer><!-- /.post-info -->                        <p>I've worked with SQLAlchemy for a while now, and in my opinion it's the best ORM in Python. It's feature rich with strong support for all major databases. And it maintains the SQL feel without losing things like typing.</p>
<p>However there are some challenges here. Despite having very nice documentation …</p>
                        <a class="readmore" href="../my-sqlalchemy-cookbook.html">read more</a>
                    </div><!-- /.entry-content -->
                </article></li>
                    </ol><!-- /#posts-list -->
  <nav>
    <ul>
      <li>Page 1 / 2</li>
        <li><a href="../author/jamie-chang2.html">&rang;</a></li>
        <li><a href="../author/jamie-chang2.html">&Rang;</a></li>
    </ul>
  </nav>
                    </section><!-- /#content -->
                <section id="extras" class="body">
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>
                                                        <li><a href="https://blog.changs.co.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                                                        <li><a href="https://github.com/Jamie-Chang/">Github</a></li>
                                                        <li><a href="https://www.linkedin.com/in/jamie-chang-4423ba125/">LinkedIn</a></li>
                                                        <li><a href="https://bsky.app/profile/jamie-chang.bsky.social/">Bluesky</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>